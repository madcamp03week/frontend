# 파일 암호화 스펙

이 문서는 클라이언트 사이드 파일 암호화/복호화에 대한 기술적 스펙을 설명합니다.

## 개요

파일은 클라이언트에서 사용자 비밀번호를 사용하여 암호화되며, 서비스에 의존하지 않고도 독립적으로 복호화할 수 있도록 설계되었습니다.

## 암호화 알고리즘

### 기본 정보
- **암호화 방식**: XChaCha20-Poly1305 (AEAD)
- **키 길이**: 32바이트 (256비트)
- **Nonce 길이**: 24바이트
- **Salt 길이**: 16바이트

### 키 생성
- **키 유도 함수**: Argon2
- **메모리 제한**: `crypto_pwhash_MEMLIMIT_INTERACTIVE`
- **연산 제한**: `crypto_pwhash_OPSLIMIT_INTERACTIVE`
- **알고리즘**: `crypto_pwhash_ALG_DEFAULT`

## 데이터 구조

### 암호화된 데이터 구조
암호화된 데이터는 base64로 인코딩되며, 다음과 같은 구조를 가집니다:

```
[Salt (16바이트)] + [Nonce (24바이트)] + [암호화된 데이터]
```

### 복호화된 데이터 구조
복호화된 데이터는 다음과 같은 구조입니다:

```
[메타데이터 길이 (4바이트, Big Endian)] + [메타데이터 JSON] + [파일 데이터]
```

## 메타데이터 형식

메타데이터는 JSON 형식으로 저장되며, 다음 필드들을 포함합니다:

```json
{
  "originalName": "파일명.확장자",
  "extension": "확장자",
  "size": 파일크기,
  "type": "MIME 타입",
  "lastModified": 타임스탬프
}
```

## 독립적 복호화를 위한 요구사항

### 필요한 라이브러리
- **libsodium-wrappers-sumo** 또는 호환되는 libsodium 라이브러리

### 필요한 정보
1. 원본 비밀번호
2. 암호화된 base64 데이터
3. 위의 모든 파라미터와 구조 정보

### 복호화 과정
1. base64 디코딩
2. Salt, Nonce, 암호화된 데이터 분리
3. Argon2를 사용하여 비밀번호로부터 키 생성
4. XChaCha20-Poly1305로 복호화
5. 메타데이터 길이 추출 (Big Endian)
6. 메타데이터와 파일 데이터 분리
7. 메타데이터 JSON 파싱
8. File 객체 생성

## 보안 고려사항

- 비밀번호는 최소 6자 이상이어야 합니다
- 각 파일마다 고유한 Salt와 Nonce가 생성됩니다
- 메타데이터와 파일 데이터가 함께 암호화됩니다
- AEAD를 사용하여 무결성 검증이 포함됩니다

## 호환성

이 스펙을 따르는 암호화된 파일은 다음 환경에서 복호화할 수 있습니다:
- Node.js (libsodium-wrappers-sumo)
- 브라우저 (libsodium-wrappers-sumo)
- 기타 libsodium을 지원하는 플랫폼 